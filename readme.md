# æ™ºæ…§å•†ç”¨è¨ˆç®—æ©Ÿ (Smart Commercial Calculator)

åŸºæ–¼ AI Agent çš„æ™ºæ…§å‹å•†ç”¨è¨ˆç®—æ©Ÿï¼Œæ”¯æ´è‡ªç„¶èªè¨€è¼¸å…¥é€²è¡Œè¤‡é›œçš„å•†æ¥­è¨ˆç®—ã€‚

## åŠŸèƒ½ç‰¹è‰²

- ğŸ§® **å‚³çµ±è¨ˆç®—æ©Ÿ** - åŸºæœ¬å››å‰‡é‹ç®—
- ğŸ¤– **AI Agent** - è‡ªç„¶èªè¨€ç†è§£èˆ‡è¨ˆç®—
- ğŸ’° **å•†æ¥­è¨ˆç®—** - æŠ˜æ‰£ã€ç¨…é‡‘ã€æˆæœ¬åˆ†æ
- ğŸ“ **å–®ä½è½‰æ›** - å°ç£åœŸåœ°å–®ä½ï¼ˆå…¬é ƒã€ç”²ã€åˆ†ã€ç•ã€åªï¼‰
- ğŸ–¥ï¸ **è·¨å¹³å°** - Windows / Linux / macOS

## ä½¿ç”¨ç¯„ä¾‹

```
è¼¸å…¥: $200çš„å•†å“æ‰“75æŠ˜åŠ ä¸Š5%çš„ç¨…
è¼¸å‡º: åŸåƒ¹ $200 â†’ 75æŠ˜å¾Œ $150 â†’ åŠ 5%ç¨… â†’ æœ€çµ‚ $157.50

è¼¸å…¥: æˆ‘æœ‰ä¸€å¡Šä¸€å…¬é ƒçš„åœ°ï¼Œç¾åœ¨ä¸€ç•50è¬ï¼Œæˆ‘å¯ä»¥è³£å¤šå°‘ï¼Ÿ
è¼¸å‡º: 1å…¬é ƒ = 15ç• â†’ 15 Ã— 50è¬ = $7,500,000
```

## å°ˆæ¡ˆçµæ§‹

```
nkust-calculator/
â”œâ”€â”€ README.md                 # æœ¬æ–‡ä»¶
â”œâ”€â”€ backend/                  # Python å¾Œç«¯
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ main.py               # FastAPI å…¥å£ (é–‹ç™¼ç”¨)
â”‚   â”œâ”€â”€ ipc_server.py         # IPC ä¼ºæœå™¨ (ç”Ÿç”¢ç”¨)
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ engine.py         # è¨ˆç®—æ©Ÿå¼•æ“
â”‚   â”‚   â”œâ”€â”€ units.py          # å–®ä½è½‰æ›
â”‚   â”‚   â””â”€â”€ commercial.py     # å•†æ¥­è¨ˆç®—
â”‚   â”œâ”€â”€ agent/
â”‚   â”‚   â”œâ”€â”€ tools.py          # Agent å·¥å…·å®šç¾©
â”‚   â”‚   â”œâ”€â”€ llm_client.py     # LLM API æ•´åˆ
â”‚   â”‚   â””â”€â”€ parser.py         # è‡ªç„¶èªè¨€è§£æ
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ routes.py         # API è·¯ç”±
â”œâ”€â”€ frontend/                 # Electron + React å‰ç«¯
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ main.js               # Electron ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ preload.js            # é è¼‰è…³æœ¬
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ App.tsx
â”‚       â”œâ”€â”€ components/
â”‚       â””â”€â”€ hooks/
â””â”€â”€ scripts/
    â”œâ”€â”€ start-dev.sh          # Linux/macOS é–‹ç™¼å•Ÿå‹•
    â”œâ”€â”€ start-dev.ps1         # Windows é–‹ç™¼å•Ÿå‹•
    â””â”€â”€ build.sh              # æ‰“åŒ…è…³æœ¬
```

## ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Electron (Frontend)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å‚³çµ±è¨ˆç®—æ©Ÿ UI   â”‚  â”‚     è‡ªç„¶èªè¨€è¼¸å…¥å€           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ IPC (stdin/stdout)
                         â”‚ ä¸éœ€è¦ç¶²è·¯ Port
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Python (Backend)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   è¨ˆç®—å¼•æ“    â”‚  â”‚  AI Agent    â”‚  â”‚  å–®ä½è½‰æ›     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒéœ€æ±‚

- Python 3.10+
- Node.js 18+
- Anthropic API Key (ç”¨æ–¼ AI Agent)

### å®‰è£æ­¥é©Ÿ

```bash
# 1. Clone å°ˆæ¡ˆ
git clone https://github.com/your-repo/nkust-calculator.git
cd nkust-calculator

# 2. å®‰è£å¾Œç«¯ä¾è³´
cd backend
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt

# 3. è¨­å®šç’°å¢ƒè®Šæ•¸
cp .env.example .env
# ç·¨è¼¯ .env å¡«å…¥ ANTHROPIC_API_KEY

# 4. å®‰è£å‰ç«¯ä¾è³´
cd ../frontend
npm install
```

### å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ

#### æ–¹å¼ä¸€ï¼šåˆ†é–‹å•Ÿå‹•ï¼ˆæ¨è–¦é–‹ç™¼æ™‚ä½¿ç”¨ï¼‰

```bash
# çµ‚ç«¯æ©Ÿ 1 - å¾Œç«¯
cd backend
source .venv/bin/activate
python -m uvicorn main:app --reload --port 8000

# çµ‚ç«¯æ©Ÿ 2 - å‰ç«¯
cd frontend
npm run dev
```

#### æ–¹å¼äºŒï¼šä¸€éµå•Ÿå‹•

```bash
# Linux/macOS
./scripts/start-dev.sh

# Windows
.\scripts\start-dev.ps1
```

## é€šè¨Šæ©Ÿåˆ¶èªªæ˜

æœ¬å°ˆæ¡ˆä½¿ç”¨ **stdin/stdout IPC** è€Œéå‚³çµ±çš„ HTTP Port é€šè¨Šã€‚

### ç‚ºä»€éº¼ä¸ç”¨ Portï¼Ÿ

| å•é¡Œ | Port æ–¹æ¡ˆ | IPC æ–¹æ¡ˆ |
|------|-----------|----------|
| Port è¢«ä½”ç”¨ | âŒ å•Ÿå‹•å¤±æ•— | âœ… ä¸éœ€è¦ Port |
| é˜²ç«ç‰†é˜»æ“‹ | âŒ å¯èƒ½è¢«æ“‹ | âœ… ä¸ç¶“éç¶²è·¯ |
| å…¶ä»–ç¨‹å¼å¹²æ“¾ | âŒ å¯èƒ½è¡çª | âœ… é€²ç¨‹å®Œå…¨ç¨ç«‹ |

### IPC é‹ä½œåŸç†

```
Electron                          Python
   â”‚                                 â”‚
   â”‚â”€â”€â”€â”€ JSON request (stdin) â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                                 â”‚ è™•ç†è«‹æ±‚
   â”‚â—„â”€â”€â”€ JSON response (stdout) â”€â”€â”€â”€â”€â”‚
   â”‚                                 â”‚
```

æ¯å€‹ Python é€²ç¨‹éƒ½æœ‰ç¨ç«‹çš„ stdin/stdoutï¼Œä¸æœƒèˆ‡å…¶ä»–ç¨‹å¼è¡çªã€‚

## æ‰“åŒ…ç™¼å¸ƒ

### æ‰“åŒ…å¾Œç«¯ (PyInstaller)

```bash
cd backend
pip install pyinstaller
pyinstaller --onefile ipc_server.py
# ç”¢å‡º: dist/ipc_server (Linux/macOS) æˆ– dist/ipc_server.exe (Windows)
```

### æ‰“åŒ…å‰ç«¯ (Electron Builder)

```bash
cd frontend
npm run build
```

### å®Œæ•´æ‰“åŒ…

```bash
./scripts/build.sh
# ç”¢å‡º: release/ ç›®éŒ„ä¸‹çš„å®‰è£æª”
```

## é–‹ç™¼æ³¨æ„äº‹é …

### âš ï¸ é‡è¦æé†’

1. **API Key å®‰å…¨**
   - æ°¸é ä¸è¦æŠŠ `ANTHROPIC_API_KEY` æäº¤åˆ° Git
   - ä½¿ç”¨ `.env` æª”æ¡ˆç®¡ç†æ•æ„Ÿè³‡è¨Š

2. **é€²ç¨‹ç®¡ç†**
   - Electron é—œé–‰æ™‚å¿…é ˆ kill Python é€²ç¨‹
   - é¿å…ç”¢ç”Ÿæ®­å±é€²ç¨‹

3. **è·¨å¹³å°è·¯å¾‘**
   - ä½¿ç”¨ `path.join()` è™•ç†æª”æ¡ˆè·¯å¾‘
   - æ³¨æ„ Python åŸ·è¡Œæª”åç¨±å·®ç•° (`python` vs `python3`)

4. **ç·¨ç¢¼å•é¡Œ**
   - IPC é€šè¨Šçµ±ä¸€ä½¿ç”¨ UTF-8
   - JSON åºåˆ—åŒ–æ™‚è¨­å®š `ensure_ascii=False`

### å¸¸è¦‹å•é¡Œ

<details>
<summary>Q: Python é€²ç¨‹æ²’æœ‰æ­£ç¢ºé—œé–‰ï¼Ÿ</summary>

ç¢ºä¿åœ¨æ‰€æœ‰é€€å‡ºäº‹ä»¶ä¸­éƒ½æœ‰è™•ç†ï¼š

```javascript
app.on('before-quit', () => pythonProcess?.kill());
app.on('window-all-closed', () => pythonProcess?.kill());
process.on('exit', () => pythonProcess?.kill());
```
</details>

<details>
<summary>Q: Windows ä¸Šå‡ºç¾å‘½ä»¤æç¤ºå­—å…ƒè¦–çª—ï¼Ÿ</summary>

spawn æ™‚åŠ ä¸Š `windowsHide: true`ï¼š

```javascript
spawn(command, args, { windowsHide: true });
```
</details>

<details>
<summary>Q: å–®ä½è½‰æ›çµæœä¸æ­£ç¢ºï¼Ÿ</summary>

æ³¨æ„å°ç£èˆ‡ä¸­åœ‹çš„åœŸåœ°å–®ä½å·®ç•°ï¼š
- **ç•**ï¼ˆä¸­åœ‹ï¼‰ï¼š1 ç• â‰ˆ 666.67 mÂ²
- **ç”²**ï¼ˆå°ç£ï¼‰ï¼š1 ç”² â‰ˆ 9699.17 mÂ²
</details>

## æŠ€è¡“æ£§

| é¡åˆ¥ | æŠ€è¡“                          |
|------|-----------------------------|
| å¾Œç«¯æ¡†æ¶ | FastAPI, Python 3.10+       |
| AI | Claude ã€ChatGPTã€Gemini      |
| å‰ç«¯æ¡†æ¶ | Electron, React, TypeScript |
| å»ºæ§‹å·¥å…· | Vite, PyInstaller           |
| é€šè¨Š | stdin/stdout IPC            |

## License

MIT License

## è²¢ç»è€…

- NKUST é›»å­å·¥ç¨‹ç³» AI è³‡å®‰çµ„
